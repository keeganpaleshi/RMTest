allow_fallback: true

analysis_isotope: radon

# Allow negative baseline-corrected rates. When enabled the reported values are
# preserved exactly; otherwise negatives are clamped to 0.0 Bq.
allow_negative_baseline: false

pipeline:
  log_level: INFO
  random_seed: 67
analysis:
  analysis_start_time: '2023-06-14T00:00:00Z'
  analysis_end_time: '2025-02-23T23:59:59Z'
  spike_end_time: '2023-07-31T00:10:00Z'
  spike_periods:
  - - '2023-11-12T00:00:00Z'
    - '2023-11-13T12:00:00Z'
  run_periods:
  - - '2023-09-28T00:00:00Z'
    - '2023-10-28T23:59:59Z'
  - - '2024-01-05T00:00:00Z'
    - '2024-01-10T23:59:59Z'
  radon_interval:
  - '2023-06-14T00:00:00Z'
  - '2025-02-23T23:59:59Z'
  ambient_concentration: null
columns:
  timestamp: timestamps
  adc: adc_channels
baseline:
  range:
  - '2024-09-28T00:00:00Z'
  - '2024-10-28T23:59:59Z'
  monitor_volume_l: 605.0
  sample_volume_l: 10.0
  isotopes_to_subtract:
  - noise
burst_filter:
  burst_mode: rate
  burst_window_size_s: 60
  rolling_median_window: 5
  burst_multiplier: 5
  micro_window_size_s: 1
  micro_count_threshold: 3
calibration:
  method: two-point
  noise_cutoff: 400
  hist_bins: 2000
  peak_search_radius: 100
  peak_prominence: 5
  peak_width: 5
  peak_widths:
    Po210: 5
    Po218: 5
    Po214: 5
  slope_MeV_per_ch: 0.00427
  float_slope: true
  use_two_point: true
  nominal_adc:
    Po210: 1246
    Po218: 1399
    Po214: 1802
  fit_window_adc: 40
  fit_retry_window: 60
  fit_maxfev: 15000
  curve_fit_max_evaluations: 10000
  use_emg: true
  init_sigma_adc: 10.0
  sigma_E_init: null
  init_tau_adc: 1.0
  sanity_tolerance_mev: 1.0
  known_energies:
    Po210: 5.304
    Po218: 6.002
    Po214: 7.687
spectral_fit:
  do_spectral_fit: true
  spectral_binning_mode: energy
  energy_bin_width: 0.0130
  fd_hist_bins: 400
  mu_sigma: 0.005
  fit_energy_range:
  - 4.8
  - 8.3
  amp_prior_scale: 5.0
  bkg_mode: "loglin_unit"
  clip_floor: 1e-300
  b0_prior:
    - 0.0
    - 2.0
  b1_prior:
    - 0.0
    - 2.0
  S_bkg_prior:
    - 0.0
    - 5.0
  tau_Po210_prior_mean: 0.010
  tau_Po210_prior_sigma: 0.006
  tau_Po218_prior_mean: 0.030
  tau_Po218_prior_sigma: 0.020
  tau_Po214_prior_mean: 0.010
  tau_Po214_prior_sigma: 0.005
  spectral_peak_tolerance_mev: 0.2
  sigma_E_prior_source: "calibration"
  sigma_E_prior_sigma: 0.015
  sigma_E_prior_mean: 0.055
  use_emg:
    Po210: true
    Po218: true
    Po214: true
  max_tau_ratio: 0.75
  float_sigma_E: true
  peak_search_prominence: 30
  peak_search_width_adc: 3
  peak_search_method: prominence
  peak_search_cwt_widths: null
  refit_aic_threshold: 2.0
  use_plot_bins_for_fit: true
  unbinned_likelihood: false
  flags:
    fix_sigma0: false  # allow the width to float
    sigma0_prior:
      - 0.13
      - 0.05
    fix_F: true       # fix the Fano factor
    F_prior:
      - 0.0
      - 0.01
  mu_bounds:
    Po210:
      - 5.20
      - 5.30
    Po218:
      - 5.95
      - 6.05
    Po214:
      - 7.60
      - 7.71
time_fit:
  do_time_fit: true
  window_po214:
    - 7.55
    - 7.80
  window_po218:
    - 5.90
    - 6.10
  window_po210:
    - 5.25
    - 5.37
  eff_po214: 0.99
  eff_po218: null
  eff_po210: null
  hl_po214: null
  hl_po218: null
  bkg_po214:
    - 0.0
    - 0.2
  bkg_po218:
    - 0.0
    - 0.0
  sig_n0_po214: 1.0
  sig_n0_po218: 1.0
  background_guess: 0.0
  n0_guess_fraction: 0.1
  flags:
    fix_background_b: false
    fix_N0_Po218: false
systematics:
  enable: false
  sigma_E_frac: 0.1
  tail_fraction: 0.05
  energy_shift_keV: 0.001
  adc_drift_rate: 0.0
  adc_drift_mode: linear
  adc_drift_params: null
radon_inference:
  enabled: true
  source_isotopes:
  - Po214
  - Po218
  source_weights:
    Po214: 0.7
    Po218: 0.3
  detection_efficiency:
    Po214: 0.12
    Po218: 0.1
  transport_efficiency: 1.0
  retention_efficiency: 1.0
  chain_correction: none  # allowed: none, assume_equilibrium, forward_model
  external_rn:
    mode: constant  # allowed: constant, file
    constant_bq_per_m3: 80.0
    file_path: mine_rn_timeseries.csv
    time_column: timestamp
    value_column: rn_bq_per_m3
    tz: America/Toronto
  output:
    write_per_interval: true
    write_cumulative: true
plotting:
  plot_spectrum_binsize_adc: 1
  plot_time_binning_mode: fixed
  plot_time_bin_width_s: 14400
  plot_time_normalise_rate: true
  time_bins_fallback: 1
  plot_save_formats:
  - png
  dump_time_series_json: true
  plot_time_style: lines
  overlay_isotopes: true
